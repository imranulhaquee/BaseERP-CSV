{% extends 'B1_Setup/LpBase.html' %}
{% block title %} | Home {% endblock title %}
{% block body %}
{% load static%}



<!--.........................................................................-->
<!--==== Main Container ==============================================//Start-->
<!--.........................................................................-->
	<div class="mainCon">

		<!--════ Heading Section ══════════════════════════════════════ //Start-->
			<div class="heading"> 
				<div> <img src=" {% static 'Java/Images/Logo/clientLogo.png' %}" style="width:175px;" alt=""> </div>
				<h2><span class="span1">┃</span><span class="span2">Sales Order</span> </h2>
			</div>
		<!--════ Heading Section ══════════════════════════════════════ //Start-->
			
		<!--════ TOP Section ══════════════════════════════════════════ //Start-->
			<div class="top"> 
				<div class="boxA"> 
					<div class="inputField">
						<p>Sales Order Ref:</p> 
						<input disabled type="text" id="soRef" name="soRef" placeholder="Ref #" style="width:180px; min-width:180px;"> 
					</div>
					<div class="inputField">
						<p>Sales Order Date:</p> 
						<input type="date" id="soDat" name="soDat" style="width:180px; min-width:180px;">
					</div>
					<div class="inputField">
						<p>Customer ID:</p>
						<input disabled type="text" id="cusCode" name="cusCode" style="width:180px; min-width:180px;">
					</div>
					<div class="inputField">     
						<p>Customer Name:</p> 
						<input type="text" id="cusName" name="cusName" disabled style="width:450px; min-width:300px;">
					</div>
				</div>
				<div class="boxB"> 
					<div class="inputFieldB">
						<p></p>
						<input disabled type="text" id="selSalCode" name="selSalCode" placeholder="Quotation" style="width:120px; min-width:120px; text-align:right; padding-right:25px; margin-right:-15px;">
						<p1 onclick="showPop_A()" style="position:relative; left:-2px; bottom:2px; color:orange; font-weight:bold; cursor:pointer;" >☰</p1>
					</div>
						<!--━━━━ Sales Quotation (Search Table Pop) ━━━━━━━━━━━━━━━━━━━━━-->
							<div  id="Pop_A"  onmouseleave="hidePop_A()" > 
								<div class="sDiv">
									<div class="Sear">
										<img onclick="fetchPop_A()" style="cursor:pointer; width:15px; " class="Icon iA" src="{% static "JAVA/Images/Icon/search.png" %}" alt="" >
										<span  class="Icon iB">🞃 |</span>
										<input id="filter_A" onkeyup="filter_A()" type="text" placeholder="Search by Customer" >
									</div>
									<div onclick="hidePop_A()" class="closeBtn"> X </div>
								</div>
								<table id="table_A">
									<tr class="tableHead"> <th style="width:80px">Quotation #</th> <th>Date</th> <th>Status</th> <th>Customer</th> </tr>
									<tbody id="popBody_A"> </tbody>
								</table>
							</div>
						<!--━━━━ Sales Quotation (Search Table Pop_A) ━━━━━━━━━━━━━━━━━━━-->

					<div class="inputFieldB">
						<p style="width:120px; min-width:120px;">Quotation Ref:</p> 
						<input disabled type="text" id="qotRef" name="qotRef" placeholder="Ref #" style="width:120px; min-width:120px; text-align:right; padding-right:20px;"> 
					</div>
					<div class="inputFieldB">
						<p style="width:120px; min-width:120px;">Quotation Date:</p> 
						<input type="date" id="qotDat" name="qotDat" disabled=true style="width:120px; min-width:120px; text-align:right;">
					</div>				
				</div>
			</div>
		<!--════ TOP Section ═══════════════════════════════════════════ //Start-->


		<!--════ Table Section ══════════════════════════════════════════ //Start-->

			<!--==== Item Search Table ======================================== -->
					<!--━━━━ Customer Code (Search Table Pop) ━━━━━━━━━━━━━━━━━━━━━-->
						<div  id="Pop_B"  onmouseleave="hidePop_B()" > 
							<div class="sDiv">
								<div class="Sear">
									<img onclick="fetchPop_B()" style="cursor:pointer " class="Icon iA" src="{% static "JAVA/Images/Icon/search.png" %}" alt="" width="15px" >
									<span  class="Icon iB">🞃 |</span>
									<input id="filter_B" onkeyup="filter_B()" type="text" placeholder="Search Item" >
								</div>
								<div class="boxAA">
									<div onclick="cashCustomer()"> General Item</div>
								</div>
								<div class="boxAB">
									<div><a href="/addCustomer" target="_blank"> +Item </a></div>
								</div>
								<div onclick="hidePop_B()" class="closeBtn"> X </div>
							</div>
							<table id="table_B">
								<tr class="tableHead"> <th style="width:80px"> Item #</th>  <th>Item Name</th> <th>Item Cost</th></tr>
								<tbody id="popBody_B"> </tbody>
							</table>
						</div>
					<!--━━━━ Customer Code (Search Table Pop_A) ━━━━━━━━━━━━━━━━━━━-->
			<!--==== Item Search Table ======================================== -->
	

			<!--==== Table ==================================================== -->
				<div class="Table">
					<table id="myTable" >
						<!--== Table First Heading =========================================-->
							<tr  style="text-align:center; position:relative">
								<th style="text-align: center;"width="25px;"class="addRow" onclick="create_tr('tBody')"> ✚ </th>
								<th width="20px;" style="text-align:center;"> </th> 
								<th width="50px;">S.No</th>
								<th width="80px;">Item Code </th>
								<th >Item Description</th>
								<th width="80px;">Quantity</th>
								<th width="80px;">Price</th>
								<th width="80px;">Discunt</th>
								<th width="120px;">Total</th>
								<th style="display:none">ID</th>
							</tr>
						<!--== Table Second Heading (Hidden) for field name ===============-->
							<tr style="display:none">
								<th></th>
								<th></th>
								<th>sno</th>
								<th>itmCode</th>
								<th>desc</th>
								<th>qty</th>
								<th>price</th>
								<th>disc</th>
								<th>tot</th>
								<th style="display:none">id</th>
							</tr>
						<!--== Table Body (Input) to get value =============================-->
							<tbody id="tBody">
								<tr>
									<td><button class="remRow" onclick="remove_tr(this)"> 🗑 </button></td>
									<td style="text-align:center;"><button onclick="getRowAndCellIndex(this)" style="border-radius:5px; color:orange; font-size: 15px; font-weight:bold; padding: 0px 2px 2px 2px; cursor:pointer">☰</button></td>                     
									<td><input type="number" id="sno" class="input" value=1 disabled=true></td>
									<td><input  id="itmCod" type="text" disabled=true></td>
									<td ><input  id="desc" type="text" disabled=true></td>
									<td><input type="floatformat" step="0.01" class="input numInput" value=0 onkeyup="getTot(this)" style="text-align:right"> </td>
									<td><input type="floatformat" step="0.01" class="input numInput" value=0 onkeyup="getTot(this)" style="text-align:right"> </td>
									<td><input type="floatformat" step="0.01" class="input numInput" value=0 onkeyup="getTot(this)" style="text-align:right"> </td>
									<td><input type="floatformat" step="0.01" class="input numInput" value=0 disabled=true  style="text-align:right"> </td>
									<td><input type="number"  class="input" value=0 disabled=true  style="text-align:right; display:none" disabled> </td>
								</tr>
							</tbody>
					</table>
				</div>
			<!--==== Table ==================================================== -->

		<!--════ Table Section ══════════════════════════════════════════ // End -->


		<!--════ Total Section ═══════════════════════════════════════════ //Start-->
			<div class="total"> 
				<div class="boxA"> 
				</div>
				<div class="boxB"> 
					<div class="inputField">
						<p>Total Before Discount : AED</p> 
						<input type="floatformat" id="soTBD" disabled=true> 
					</div>
					<div class="inputField">
						<p>Total After Discount : AED</p> 
						<input type="floatformat" id="soTAD" disabled=true>
					</div>

					<div class="inputField">
						<p>Total Tax Amount : AED</p>
						<input type="floatformat" id="soTax" disabled=true>
					</div>

					<div class="inputField">     
						<p>Total Including Tax : AED</p> 
						<input type="floatformat" id="soTAT" disabled=true>
					</div>
				</div>
			</div><br><br>		
	  <!--════ Total Section ═══════════════════════════════════════════ //Start-->


		<!--════ Bottom Section ═══════════════════════════════════════ //Start-->
			<div class="Bottom">
				<div>
					<label> <span>Ship To </span> 
					<textarea type="text" id="shipTo" name="shipTo" class="tabA" id="addShip" rows="3"></textarea> </label>
				</div>
				<div>
					<label> <span>Invoice / Bill To </span> 
					<textarea type="text" id="billTo" name="billTo" class="tabA" id="addBill" rows="3"></textarea> </label>
				</div>
			</div>
		<!--════ Bottom Section ═══════════════════════════════════════ //Start-->


		<!--════ Sales Section ═══════════════════════════════════════ //Start-->
			<div class="salSec">
					<div class="boxA">
						<div>
							<div>Description</div>
							<textarea type="text" id="soComm" name="soComm" class="tabA" id="addComm" rows="3"></textarea>
						</div>
					</div>
					<div class="boxB"> 
						<div style="position:relative; display:flex; flex-wrap:wrap; justify-content:end">
							<div style="min-width:120px;">Sales Person </div>
							<div><input type="text" id="spName" name="spName" style="min-width:220px;" disabled=true></div>
							<div style="display:none"><input type="text" id="salPer" name="salPer" style="min-width:220px;"></div>
							
							<p1 onclick="showPop_S()" style="position:absolute; top:0; right:0; color:orange; font-weight:bold; cursor:pointer" >☰</p1>
		
							<!--━━━━ Employee Code (Search Table Pop) ━━━━━━━━━━━━━━━━━━━━━-->
								<div  id="Pop_S"  onmouseleave="hidePop_S()" > 
									<div class="sDiv">
										<div class="Sear">
											<img onclick="fetchPop_S()" style="cursor:pointer " class="Icon iA" src="{% static "JAVA/Images/Icon/search.png" %}" alt="" width="15px" >
											<span  class="Icon iB">🞃 |</span>
											<input id="filter_S" onkeyup="filter_S()" type="text" placeholder="Search Employee" >
										</div>
		
										<div onclick="hidePop_S()" class="closeBtn"> X </div>
									</div>
									<table id="table_S">
										<tr class="tableHead"> <th style="width:80px"> Employee #</th>  <th>Employee Name</th> </tr>
										<tbody id="popBody_S"> </tbody>
									</table>
								</div>
							<!--━━━━ Employee Code (Search Table Pop_S) ━━━━━━━━━━━━━━━━━━━-->
		
						</div>
					</div>

			</div><br>	
		<!--════ Sales Section ═══════════════════════════════════════ //Start-->
		

	<!--════ Save Section ══════════════════════════════════════ //Start-->
			<section id="savSec">
				<div><button  onclick="event.preventDefault()" class="hBtn" type="submit"> ⚠ HELP</button></div>
				<div><button onclick="canRecord()" id="cancelA" class="cBtn" type="submit"> ✂ CANCEL</button></div>
				<div><button onclick="addRecord()" id="addRec"  class="addRec sBtn" type="submit" disabled=true>✚ Save</button></div>
			</section>
		<!--════ Save Section ══════════════════════════════════════ // End -->

	</div><br><br>
<!--==== Main Container ==============================================// End -->



<!--.........................................................................-->
<!--==== PAGE JS =====================================================//Start-->
  <script> 

		//.... Get Data from Context Process and General Functions ...............
			let basInfo = {{basInfo|safe}}
		//.... Get Data from Context Process and General Functions ...............

		//▒▒▒▒▒▒ Sales Order Number and Date and Form Validation ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
			
      	//==== Last Sales Order Number // Date =====================//Start-->
          let newSoNum
          let newSoDat
          function soNumber(){
            const mmm = {{lastOrder|safe}}  // get data from django noraml return
            document.querySelector('#soRef').value = mmm+1;
            newSoNum = mmm+1

            // display the formatted date -----------------
            let currentDate = new Date();
            //let formattedDate = `${(currentDate.getMonth() + 1).toString().padStart(2, '0')}/${currentDate.getDate().toString().padStart(2, '0')}/${currentDate.getFullYear()}`;
            let inputDate = document.getElementById("soDat");
            inputDate.value = currentDate.toISOString().substr(0, 10);

            newSoDat = currentDate.toISOString().substr(0, 10);
          }
        	soNumber()
      	//==== Last Sales Order Number // Date =====================// End -->


				//==== Form Validation =====================================//Start-->
					function savDisable (elem) {
						const subBtn = document.querySelector(".addRec");
						if (elem == 'Yes'){
								subBtn.disabled = true;
								subBtn.classList.remove('addColor')
						}else{
								subBtn.disabled = false;
								subBtn.classList.add('addColor')
						}
					}
				//==== Form Validation =====================================// End -->

		//▒▒▒▒▒▒ Sales Order Number and Date and Form Validation ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒


		//▒▒▒▒▒▒ SHOW DATA ON INITIAL LOAD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒

      //---- Fetch Sales Quotation Detail Data -------------------------------
      let qotDetailData=[];
      async function fetchQotDetail(qRef) {
          const response = await fetch(`${basInfo.IP[0]}/sQuotEditFetch/${qRef}`)
          const data = await response.json()
					qotDetailData=data
 					showQoutDetail(data)
      }

			//■■■■■ Get Quotation Detail ■■■■■■■■■■■■■■■■■■■■■■■■
			function showQoutDetail(data){
				//console.log(data)

				document.querySelector('#qotRef').value = data[0].qotRef;
				document.querySelector("#qotDat").value = data[0].qotDat;
				document.querySelector("#cusCode").value = data[0].cusCode;
				document.querySelector("#cusName").value = data[0].cusName;
				document.querySelector("#soTBD").value = data[0].qotTBD.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.querySelector("#soTAD").value = data[0].qotTAD.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.querySelector("#soTax").value = data[0].qotTax.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.querySelector("#soTAT").value = data[0].qotTAT.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.querySelector("#soComm").value = data[0].qotComm;
				document.querySelector("#billTo").value = data[0].shipTo;
				document.querySelector("#shipTo").value = data[0].shipTo;
				document.querySelector("#salPer").value = data[0].salPer;
				document.querySelector("#spName").value = data[0].spName;


				//console.log(finalData)
				var table = document.getElementById('tBody')
						
				//to empty the table rows already exist...................................
				var rows = table.rows.length;
				if (rows >= 2) { //reset form and delete all rows
						//formEquip.reset()  //reset form if even if there is a single 
						for (let i = 0; i < rows-1; i++) {
								var delRow = table.deleteRow(1)  //delete first row which is emptry
						}
				}

				if (data[1].length!=0) { //to avoid delete first row incase of empty record that cause of error
						data[1].map(editable).join('')  //-----MAP------------------------
						function editable(Data){
								last_tr   = table.lastElementChild,
								tr_clone   = last_tr.cloneNode(true);
								table.append(tr_clone);
								var lastRow = table.rows[ table.rows.length -1 ]   //get the last row of the table
								var Col_id = lastRow.cells[2].getElementsByTagName('input')[0].value = Data.sno;
								var Col_id = lastRow.cells[3].getElementsByTagName('input')[0].value = Data.itmCode;
								var Col_id = lastRow.cells[4].getElementsByTagName('input')[0].value = Data.desc;
								var Col_id = lastRow.cells[5].getElementsByTagName('input')[0].value = Data.qty.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
								var Col_id = lastRow.cells[6].getElementsByTagName('input')[0].value = Data.price.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
								var Col_id = lastRow.cells[7].getElementsByTagName('input')[0].value = Data.disc.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
								var Col_id = lastRow.cells[8].getElementsByTagName('input')[0].value = Data.tot.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
								var Col_id = lastRow.cells[9].getElementsByTagName('input')[0].value = 0 //Data.id;
						}
						var delRow = table.deleteRow(0)  //delete first row which is emptry
				}
				//■■■■■ Get Quotation next Number and Current Date■■■■■■■■■■■■■■■■■■■■■■■■

				hidePop_A()
			}


		//▒▒▒▒▒▒ SHOW DATA ON INITIAL LOAD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
	
	
		//▒▒▒▒▒▒ ADD REMOVE RESET TABLE ROWS ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒

			//■■■■■ ADD NEW ROW IN THE TABLE ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
			function create_tr(table_id) {
				var tBody = document.getElementById(table_id),
					last_tr   = tBody.lastElementChild,
					tr_clone   = last_tr.cloneNode(true);
				tBody.append(tr_clone);

				//console.log(tBody.lastElementChild)
				clean_last_tr(tBody.lastElementChild);
				resetNo ()
			}

			//---- CLEAN LAST ROW ------------------------------------------------------
			function clean_last_tr(lastTr) {
				let children = lastTr.children;
				children = Array.isArray(children) ? children : Object.values(children);

				children.forEach(x=>{
						if(x !== lastTr.lastElementChild){
								x.lastElementChild.value = "";
						}
				});
			}

			//---- REMOVE LAST ROW -----------------------------------------------------
			function remove_tr(This) {
				if(This.closest('tbody').childElementCount == 1) {
						alert("You Don't have Permission to Delete This ?");
				}else{
						This.closest('tr').remove();
						getSum()
						resetNo ('No')
				}
			}
			
			//---- RAESET NO ----------------------------------------------------------
			function resetNo (Numb){
				var lastRow = tBody.rows[ tBody.rows.length - 1 ] //get the last row of the table
				var addColNo = parseInt(lastRow.cells[2].getElementsByTagName('input')[0].value); //get the value of the last row 1st cell
				var sno = addColNo + 1 //add 1 to Last Column Value
				var addSO = lastRow.cells[2].getElementsByTagName('input')[0].value = sno;
				//---Loop Throgh Table length to reset number from begning---------------
				
				var a = 0
				for (var j=0; j<tBody.rows.length; j++) {
						var x = document.getElementById("tBody").rows[a].getElementsByTagName('input')[0].value = a+1;
						a=a+1
				} 

				if (Numb=="No"){
				}else{
					//---- Give the new line Specific Value----------------------------------
					var addQty = parseInt(lastRow.cells[5].getElementsByTagName('input')[0].value = 0); //add Value to new row "Quantity" 
					var addPri = parseInt(lastRow.cells[6].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					var addDis = parseInt(lastRow.cells[7].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					var addTot = parseInt(lastRow.cells[8].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					var addID = parseInt(lastRow.cells[9].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
				}
			}

		//▒▒▒▒▒▒ ADD REMOVE RESET TABLE ROWS ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒


		//▒▒▒▒▒▒ GET TOTAL AND GRAND TOTAL ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒

			//■■■■■ GET SUM OF THE ITEM SOLD ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 
			function getTot(abc) {
				var table = document.getElementById("myTable")
				
				const ab = (abc.closest('tr').rowIndex)  //get the row number of the cell where entering the data
				const closestCell = abc.closest('td').cellIndex; //just for info (to find out cell number)
				
				//Change the input number into Comma Seperated Value ------------------
					var value = event.target.value;
					event.target.value = value.replace(/[^0-9]/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",");  
				//Change the input number into Comma Seperated Value ------------------

				var qty = parseFloat(table.rows[ab].cells[5].getElementsByTagName('input')[0].value.replace(/,/g, ''))
				var price = parseFloat(table.rows[ab].cells[6].getElementsByTagName('input')[0].value.replace(/,/g, ''))
				var disc = parseFloat(table.rows[ab].cells[7].getElementsByTagName('input')[0].value.replace(/,/g, ''))

				var tot = (qty * price) - disc
				tot = parseFloat(table.rows[ab].cells[8].getElementsByTagName('input')[0].value =  tot.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,}))
				//--console.log(tot)
				getSum()
			}
		

			//■■■■■ GET SUM OF THE TOTAL COLUMN ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 
			function getSum() {
				// Get sum of a table column --(temporary here)----------------------
				// ==================================================================
				var table = document.getElementById("myTable"), sumADis = 0; sumDis = 0;
				for(var i = 2; i < table.rows.length; i++){
						sumADis = sumADis + parseFloat(table.rows[i].cells[8].getElementsByTagName('input')[0].value.replace(/,/g, ''));
						sumDis = sumDis + parseFloat(table.rows[i].cells[7].getElementsByTagName('input')[0].value.replace(/,/g, ''));
				}
			
				document.getElementById("soTAD").value = sumADis.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				var qotTBD = sumADis + sumDis
				var VAT = sumADis*0.05
				var GTot = sumADis + VAT
				document.getElementById("soTBD").value = qotTBD.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.getElementById("soTax").value = VAT.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
				document.getElementById("soTAT").value =GTot.toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 0,});
			}

		//▒▒▒▒▒▒ GET TOTAL AND GRAND TOTAL ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒


		//▒▒▒▒▒▒ ADD RECORD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒

			//■■■■■ GET JAVASCRIPT ARRAY OF OBJECTS - BY CALLING  'tableToJson()'■■■■■■■■ 
			function addRecord() {
				var addData = tableToJson(document.getElementById("myTable")); // Get table  
					//console.log(addData)
					//console.log(addData[1][0]['description'])
					add_Record (addData)
			}
		
			//■■■■■ CONVERT HTML TABLE DATA TO JSON DATA ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
			function tableToJson(table) {
					var dataA = []
					//first row needs to be headers
					var headers = []; //if header contain code in second row means i=1
					for (var i=1; i<table.rows[1].cells.length; i++) {
							headers[i] = table.rows[1].cells[i].innerHTML.toLowerCase().replace(/ /gi,'').replace(/[.]/g,'');
					}
					
					//---- go through each cells of all rows -- to generate Arry of Qut Items ---
					for (var i=2; i<table.rows.length; i++) {
							var tableRow = table.rows[i];
							var rowData = {};
							for (var j=2; j<tableRow.cells.length; j++) {
								if(j>=5){ 
									rowData [headers[j] ] = tableRow.cells[j].getElementsByTagName('input')[0].value.replace(/,/gi,'');
								}else{
									rowData [headers[j] ] = tableRow.cells[j].getElementsByTagName('input')[0].value;
								}
									rowData ["soRef"] = document.getElementById("soRef").value;
								}
							dataA.push(rowData);
					}

					//----  Get Input field to gererate Basic Data Object ----------------------
					SoRef = document.getElementById('soRef').value;
					SoDat = document.getElementById('soDat').value;
					CusCode = document.getElementById('cusCode').value;
					CusName = document.getElementById('cusName').value;
					SoTBD = parseFloat(document.getElementById('soTBD').value.replace(/,/g, ''));
					SoTAD = parseFloat(document.getElementById('soTAD').value.replace(/,/g, ''));
					SoTax = parseFloat(document.getElementById('soTax').value.replace(/,/g, ''));
					SoTAT = parseFloat(document.getElementById('soTAT').value.replace(/,/g, ''));
					ShipTo = document.getElementById('shipTo').value;
					SoComm = document.getElementById('soComm').value;
					SpName = document.getElementById('spName').value;
					SalPer = document.getElementById('salPer').value;
					QotRef = document.getElementById('qotRef').value;
					QotDat = document.getElementById('qotDat').value;
					if (SalPer == '') {SalPer = 0;	}
					const basicData =  {  qotRef:QotRef, qotDat:QotDat, cusCode:CusCode, 
																cusName:CusName, soTBD:SoTBD, soTAD:SoTAD, soTax:SoTax,
												 				soTAT:SoTAT, shipTo:ShipTo,soRef:SoRef, soDat:SoDat, 
																soComm:SoComm, salPer:SalPer, spName:SpName };

					//Filter out Blank Rows
					let data = dataA.filter(item => item.qty !== "0"); //remove the empty rows from prodeuct detail rows

					//--- Get the rows deleted from previous saved PO to delete from data base while save again
					const missingIds = [];

					var allData = [basicData, data, missingIds]
					//----  Get Input field to gererate Basic Data Object ----------------------  
					return allData;
			}
		
			//■■■■■ CONVERT HTML TABLE DATA TO JSON DATA ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
			const add_Record = async (data) => {
					try {
					//console.log(data)
					const response = await fetch(`${basInfo.IP[0]}/sOrderAddUrl`, { 
							method: 'POST',
							body: JSON.stringify(data), 
							headers: {"Content-type":"application/json; charset=UTF-8"},
					})
					const post = await response.json();
							alert("Record Saved Successfully...")
							qotRef = document.getElementById('qotRef').value;
							list_A = list_A.filter(item => item.qotRef != qotRef);
							console.log(list_A)
							Table_A(list_A)
							addRefresh()
					} catch (e) {  
							console.log(e)
					}
			}

			//■■■■■ Refresh Quotation Form ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
			function addRefresh(){
					SoRef = document.getElementById('soRef').value;
					let num = parseInt(SoRef); // convert string to number
					num += 1; // add 1 to the number
					ref = String(num);
					document.getElementById('soRef').value = ref
					document.getElementById('qotRef').value = ""
					document.getElementById('qotDat').value = ""
					document.getElementById('cusCode').value = ""
					document.getElementById('cusName').value = ""
					document.getElementById('soTBD').value = 0
					document.getElementById('soTAD').value = 0
					document.getElementById('soTax').value = 0
					document.getElementById('soTAT').value = 0
					document.getElementById('shipTo').value = ""
					document.getElementById('billTo').value = ""
					document.getElementById('soComm').value = ""
					document.getElementById('spName').value = ""
			
					var table = document.getElementById("myTable");   
					var rows = table.rows; // Get all rows in the table except the first 3 lines
					for (var i = rows.length - 1; i >= 3; i--) {
						table.deleteRow(i);// Delete the current row
					}
			
					//---- Get the last row of the table -----------------------------------
					var lastRow = table.rows[table.rows.length - 1];
					//---- Refresh the line with nill value --------------------------------
					var addQty = lastRow.cells[3].getElementsByTagName('input')[0].value = ""; //add Value to new row "Quantity" 
					var addQty = lastRow.cells[4].getElementsByTagName('input')[0].value = ""; //add Value to new row "Quantity" 
					var addQty = parseInt(lastRow.cells[5].getElementsByTagName('input')[0].value = 0); //add Value to new row "Quantity" 
					var addPri = parseInt(lastRow.cells[6].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					var addDis = parseInt(lastRow.cells[7].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					var addTot = parseInt(lastRow.cells[8].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price"
					var addid = parseInt(lastRow.cells[9].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
					
					savDisable('Yes')  //to Disable Save option..............
			}

		//▒▒▒▒▒▒ ADD RECORD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒


		//▒▒▒▒▒▒ CANCEL RECORD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
			function canRecord(){
				document.getElementById('qotRef').value = newQotNum
				document.getElementById('qotDat').value = newQotDat
				document.getElementById('cusCode').value = ""
				document.getElementById('cusName').value = ""
				document.getElementById('qotTBD').value = 0
				document.getElementById('qotTAD').value = 0
				document.getElementById('qotTax').value = 0
				document.getElementById('qotTAT').value = 0
				document.getElementById('shipTo').value = ""
				document.getElementById('billTo').value = ""
				document.getElementById('comm').value = ""
				document.getElementById('salPer').value = ""
		
				var table = document.getElementById("myTable");   
				var rows = table.rows; // Get all rows in the table except the first 3 lines
				for (var i = rows.length - 1; i >= 3; i--) {
					table.deleteRow(i);// Delete the current row
				}
		
				//---- Get the last row of the table -----------------------------------
				var lastRow = table.rows[table.rows.length - 1];
				//---- Refresh the line with nill value --------------------------------
				var addSno = lastRow.cells[2].getElementsByTagName('input')[0].value = 1;
				var addQty = lastRow.cells[3].getElementsByTagName('input')[0].value = ""; //add Value to new row "Quantity" 
				var addQty = lastRow.cells[4].getElementsByTagName('input')[0].value = ""; //add Value to new row "Quantity" 
				var addQty = parseInt(lastRow.cells[5].getElementsByTagName('input')[0].value = 0); //add Value to new row "Quantity" 
				var addPri = parseInt(lastRow.cells[6].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
				var addDis = parseInt(lastRow.cells[7].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 
				var addTot = parseInt(lastRow.cells[8].getElementsByTagName('input')[0].value = 0); //add Value to new row "Price" 

				savDisable('Yes')  //to Disable Save option..............
			}
		//▒▒▒▒▒▒ CANCEL RECORD ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒


		//▒▒▒▒▒▒ FORM VALIDATION ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
			function savDisable (elem) {
				const subBtn = document.querySelector(".addRec");
				if (elem == 'Yes'){
					subBtn.disabled = true;
					subBtn.classList.remove('addColor')
				}else{
					subBtn.disabled = false;
					subBtn.classList.add('addColor')
				}
			}
		//▒▒▒▒▒▒ FORM VALIDATION ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒



	
	</script>
<!--.........................................................................-->



<!--.........................................................................-->
<!--==== PAGE CSS ====================================================//Start-->
	<style>

		/* ⚊⚊⚊⚊ General INPUT ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			input {
					border: none;
					box-sizing: border-box;
					border-bottom: 1px solid rgb(0, 21, 255);
					box-shadow: 1px 1px 4px #EBEBEB;
					font-size: 13px;
					padding: 2px 0 2px 5px;
			}
			input:focus { 
					outline: none; 
					background-color:#e8f0f5;
			}

			.cEdit{
				width: 100px;
			}
			.check-box {
					transform: scale(2);
			}
			input[type="checkbox"] {
					position: relative;
					appearance: none;
					width: 50px;
					height: 20px;
					background: #ccc;
					border-radius: 50px;
					box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
					cursor: pointer;
					transition: 0.4s;
			}
			input:checked[type="checkbox"] {
					background: #2CBBBB;
			}
			input[type="checkbox"]::after {
					position: absolute;
					content: "";
					width: 20px;
					height: 20px;
					top: 0;
					left: 0;
					background: #fff;
					border-radius: 50%;
					box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
					transform: scale(1.1);
					transition: 0.4s;
			}
			input:checked[type="checkbox"]::after {
					left: 60%;
			}

		/* ⚊⚊⚊⚊ General INPUT ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Main Container ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.mainCon { 
					width: 95%;
					min-width: 700px;
					margin:3%; 
					padding: 1% 3%; 
					background-color: #fff;  
					border-radius: 5px;
					border-top: 10px solid rgb(91, 80, 104); 
					border-bottom: 1px solid rgb(91, 80, 104); 
					box-shadow: 0 1px 5px rgba(0,0,0,0.15); 
					background:  url('/static/JAVA/Images/BackPng/backPng5.png') no-repeat;
					background-size: 100%; /* Adjust the value as per your preference */
					background-position: right top;
			}
		/* ⚊⚊⚊⚊ Main Container ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Heading Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.heading {
					display:flex; 
					flex-wrap:wrap; 
					justify-content: space-between; 
					width:100%; 
					margin-bottom: 20px;
			} 
			.heading .span1 {
					color:orange;
			}
			.heading .span2 {
					font-weight:300;
					letter-spacing: 3px;
			}
		/* ⚊⚊⚊⚊ Heading Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Top Section ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.top {
					position: relative;
					display:grid;
					grid-template-columns: repeat(auto-fit, minmax(300px, 1fr) );
					grid-gap: 20px;
					align-items: center; 
					margin-bottom: 10px; 
			}
			.top .boxB{
					justify-self:end;
			}
			.top .inputField{
					margin-bottom: 7px;
					display:flex;
					justify-content: start;
			}
			.top .inputFieldB{
				margin-bottom: 7px;
				display:flex;
				justify-content: end;
			}
			.top p{
					min-width: 170px;
			}
			.top .boxB img{
				position:absolute;
				width:100px; 
				border-radius:10px;
				top:0;
				right:0;
				transition: transform 0.3s;
				cursor:pointer;
			}
			.top .boxB img:hover{
				transform: scale(1.05);
			}
		/* ⚊⚊⚊⚊ Top Section ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Table Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.Table {
				margin-bottom: 20px;
				max-height:250px;
				overflow:auto;
				border-bottom: 1px solid gray;
				border-radius: 2px;
			}
			#myTable {
				font-size: 14px;
				background: #FFFDFF;
				border-collapse: collapse;
				width: 100%;    
			}
			#myTable th {
				border-bottom:2px solid #FFE485;
				background-image:linear-gradient(0deg, #354A70 15%,#8DC0EB);
				color:white;
				position:sticky;
				top:0px;
				font-weight:500;
				padding:3px 0px;
				border: 1px solid rgb(5, 120, 209);
			}
			#myTable td, tr {
				font-weight:500;
				border: 1px solid rgb(5, 120, 209);
			}
			#myTable th:first-child {
				position:-webkit-sticky;
				position: sticky;
				left: -15px;
				background:linear-gradient(0deg, #30569c 15%,#63b5f8);
				z-index: 10;
				color:#FFE485;
			}
			#myTable input {
				border: none;
				box-sizing: border-box;
				box-shadow: 1px 1px 4px #EBEBEB;
				font-size: 13px;
				margin: 3px 0;
				padding: 2px 0;
				width: 100%;
				resize: vertical;
			}
			#sno{
					text-align: center;
			}
			.addRow{
				cursor:pointer;
			}
			.remRow{
				color: #fc6f03;
				font-size: 18px;
				font-weight: bold;
				padding-left: 6px;
			}
		/* ⚊⚊⚊⚊ Table Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Total Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.total {
				position: relative;
				display:grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr) );
				grid-gap: 20px;
				align-items: center; 
				margin-bottom: 10px; 
				justify-items: end;
			}
			.total input{
				width:140px; 
				min-width:140px;
				text-align:right;
			}
			.toal .boxB{
				justify-self:end;
			}
			.total .inputField{
				margin-bottom: 7px;
				display:flex;
				justify-content: start;
			}
			.total .inputField p{
				min-width: 205px;
			}
			.total .boxB img{
				position:absolute;
				width:100px; 
				border-radius:10px;
				top:0;
				right:0;
				transition: transform 0.3s;
				cursor:pointer;
			}
			.total .boxB img:hover{
				transform: scale(1.05);
			}
		/* ⚊⚊⚊⚊ Total Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Bottom Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.Bottom {
				display:flex; 
				flex-wrap: wrap;
				justify-content: space-between;
				width:100%; 
				margin-bottom: 30px;
			}
			.Bottom label{
				width: 340px;
				font-size: 14px;
				font-weight: 400;
				float: right;
				padding-top: 8px;
				padding-right: 5px;
				color: rgb(115, 114, 114);
			}
			textarea {
				width: 300px;	
				font-size: 13px;
				min-width: 340px;
				max-width: 340px;
				padding: 3px 10px;
				margin: 4px 0;
				box-sizing: border-box;
				border: solid 1px rgb(183, 182, 182);
				border-radius: 3px;
			}
		/* ⚊⚊⚊⚊ Bottom Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Sales Person Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			.salSec {
				display:flex;  
				flex-wrap:wrap; 	
				color:gray;  
				font-size:14px;
			}
			.salSec .boxA, .salSec .boxB {		
				min-width:50%; 
			}

		/* ⚊⚊⚊⚊ Sales Person Section  ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

		/* ⚊⚊⚊⚊ Save Section ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */
			#savSec {
					display: flex;
					justify-content:flex-end;
					flex-wrap: wrap;
					padding: 5px 0px 0px 40px;
			}
			.sBtn, .hBtn, .cBtn{
					box-shadow: 4px 6px 9px -4px rgba(0,0,0,0.4);
					background-color: #AAAAAA;
					display: inline-block;
					cursor: pointer;
					color: #FFFFFF;
					font-family: 'Open Sans Condensed', sans-serif;
					font-size: 14px;
					padding: 4px 18px;
					margin: 5px 10px;
					text-decoration: none;
					text-transform: uppercase;
			}
			.cBtn{
					background-color: #1DA1F2;
			}
			.hBtn{
					background-color: #3B5998;
			}
			.addColor{
					background-color: #2CBBBB;
			}
			.cusTab3 {
					display: flex;
					justify-content:space-between;
					flex-wrap: wrap;
			}
		/* ⚊⚊⚊⚊ Save Section ⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊⚊ */

	</style>
<!--.........................................................................-->




<!--.........................................................................-->
<!--==== Quotation Deatil Popup Window ===============================//Start-->
<!--.........................................................................-->
	<script>
		//--==== Fetch Item Data to Select ================================= //Start-->
			let list_A=[]; // Declare a global variable to store the data
			
			async function fetchPop_A(){
				const response = await fetch(`${basInfo.IP[0]}/openSalQotURL`)
				const data = await response.json()
				list_A = data  //when call showRecord() function data will save in finalData
				Table_A(list_A)
				console.log(list_A)
			}
		//--==== Fetch Item Data to Select ================================= // End -->


		//------ Render Item Table ----------------------------------------- //Start-->
			function Table_A(dataList){
				//console.log(dataList)
				var table = document.getElementById('popBody_A').innerHTML=` ${dataList.map(temList).join('')}`
				function temList (e){
					return`<tr">
							<td style="color:#0464d1">${e.qotRef}</td>
							<td>${e.qotDat}</td>
							<td>${e.opnClo}</td>
							<td style="display:none"> ${e.cusCode}</td>
							<td>${e.cusName}</td>
						</tr>`
				}
				//-- on click select the row -------------------------
				var cells = document.querySelectorAll(`#popBody_A td`);
				for (var j = 0; j < cells.length; j++) {
					var cell_A1 = cells[j];
					cell_A1.onclick =  async function () {
						var rowId = this.parentNode.rowIndex-1;
						var rowSelected = document.querySelectorAll(`#popBody_A tr`)[rowId];
						clickVal1 = rowSelected.cells[0].innerHTML;
						savDisable('No')
						fetchQotDetail(clickVal1)
					}
				}
			}
		//------ Render Item Table ----------------------------------------- // End -->


		//------ Filter Records-------------------------------------------- //Start-->
			function filter_A(input){tableInside_A()}
			function tableInside_A(){
				let filter = document.querySelector('#filter_A').value.toUpperCase(); //capturing input value

				if (filter.length >= 3) {
					let abc = list_A.filter(x => x.cusName.toLowerCase().includes(filter.toLowerCase()))
					Table_A(abc)
				}else if (filter == '*'){
					Table_A(list_A)
				}
				else {
					Table_A(list_A)
				}
			}

			function remEmpAfterSave(){
				const filteredData = list_A.filter((employee) => employee.cusCode !== cuslCode);
				list_A = filteredData
				Table_A(list_A)
			}
		//------ Filter Records --------------------------------------------// End -->


		//-------Run function On Click to "show the list Div"........... //Start-->
			function showPop_A(){ 
				var abbc = document.getElementById("Pop_A");
				abbc.classList.toggle("hide"); 
				abbc.style.display = "block";
			}

			function hidePop_A(){
				var abbc = document.getElementById("Pop_A");
				abbc.style.display = "none"; 
			}

			function custHide(){
				var abbc = document.getElementById("conCol");
				abbc.style.display = "none"; 
			}
		//-------Run function On Click to "show the list Div"........... // End -->

	</script>


	<style>
		/* Customer Search Table ------------------------------------------------- */
			#Pop_A {
				position:absolute;
				margin: 0px 0 0 127px;
				display:none;
				width:500px; 
				min-height:150px;
				max-height:300px; 
				background:#fcffff; 
				border: 1px solid #3B5998;
				box-shadow: 4px 6px 9px -4px rgba(0,0,0,0.4);
				border-radius: 10px;
				overflow-y: auto;
				z-index:10; 
				right:0;
			}
			#Pop_A .sDiv{
				position:sticky;
				top:0;
				display:flex; 
				justify-content:start;
				align-items: center;
				background:#00324A;
				min-height:30px;
			}
			.sDiv .Sear {
				position:relative;
				margin-left: 5px;
				left: 2px;
			}
			.sDiv .Sear .Icon {
				position:absolute; 
				color:gray;
			}
			.sDiv .Sear .Icon.iA{
				left:7px;
				top: 4px;
			}
			.sDiv .Sear .Icon.iB{
				font-size: 10px;
				top: 2px;
				left:25px;
			}
			.sDiv .Sear input{
				border-radius: 25px;
				min-width:250px;
				height: 20px;
				margin-left: 5px;
				padding-left: 43px;
				font-size: 13px;
				box-shadow: 0px 0px 0px #EBEBEB;
				border: 1px solid rgb(209, 207, 207);  
			}
			.sDiv .closeBtn{
				position:absolute; 
				right:2px; top:2px; 
				color:red; 
				background:lightgray; 
				border-radius:50%; 
				width:20px; height:20px; 
				text-align:center;
				cursor:pointer;"
			}
		/* Table ------------------------------------------------------------------*/
			#table_A {
				margin:0;
				font-size: 11px;        
				border-collapse: collapse;
				width: 100%;
			}
			#table_A .tableHead {
				background: rgb(227, 236, 255);
				position:sticky;
				border: 1px solid #30569c;
				box-shadow: 0px 6px 2px -4px rgba(0,0,0,0.4);
				top:28px;
				z-index: 100;
			}
			#table_A td, th {
				text-align: left;
				padding: 3px 8px;
				background: none;
				border: 1px dotted rgb(149, 202, 243);
				border-collapse: collapse;
			}
		/* Customer Search Table --------------------------------------------------*/
	</style>

<!--==== Quotation Deatil Popup Window ===============================// End -->




<!--.........................................................................-->
<!--==== Item Deatil Popup Window ====================================//Start-->
<!--.........................................................................-->
	<script>
		//--==== Fetch Item Data to Select ================================= //Start-->
			let list_B=[]; // Declare a global variable to store the data
			
			async function fetchPop_B(){
				const response = await fetch(`${basInfo.IP[0]}/itemPrice`)
				const data = await response.json()
				list_B = data  //when call showRecord() function data will save in finalData
				Table_B(list_B)
				//console.log(list_B)
			}
		//--==== Fetch Item Data to Select ================================= // End -->


		//------ Render Item Table ----------------------------------------- //Start-->
			function Table_B(dataList){
				//console.log(dataList)
				var table = document.getElementById('popBody_B').innerHTML=` ${dataList.map(temList).join('')}`
				function temList (e){
					return`<tr">
										<td style="color:#0464d1">${e.itmCode}</td>
										<td>${e.itmName}</td>
										<td>${e.selPrice.toLocaleString('en',{minimumFractionDigits: 0, maximumFractionDigits:0,})}</td>
									</tr>`
				}
				//-- on click select the row -------------------------
				var cells = document.querySelectorAll(`#popBody_B td`);
				for (var j = 0; j < cells.length; j++) {
					var cell_A1 = cells[j];
					cell_A1.onclick =  async function () {
									var rowId = this.parentNode.rowIndex-1;
									var rowSelected = document.querySelectorAll(`#popBody_B tr`)[rowId];
									
									iID = rowSelected.cells[0].innerHTML;
									iName = rowSelected.cells[1].innerHTML;
									sPrice = rowSelected.cells[2].innerHTML;

									// Get the table row and cell elements
									var tableA = document.getElementById('myTable')                      
									ccd = tableA.rows[clickRow].cells[clickCell+2].getElementsByTagName('input')[0].value = iID
									ccd = tableA.rows[clickRow].cells[clickCell+3].getElementsByTagName('input')[0].value = iName
									ccd = tableA.rows[clickRow].cells[clickCell+5].getElementsByTagName('input')[0].value = sPrice
						
						hidePop_B()
						//addRefresh('newSelection')
						//savDisable('No')
					}
				}
			}
		//------ Render Item Table ----------------------------------------- // End -->


		//------ Get Clicked Row and Cell Index ---------------------------- //Start-->
			var clickRow
			var clickCell
			function getRowAndCellIndex(button) {
				showPop_B()
			
				var row = button.parentNode.parentNode; // Get the row index
				var rowIndex = row.rowIndex;          
				var cell = button.parentNode; // Get the cell index
				var cellIndex = cell.cellIndex;

				clickRow = rowIndex
				clickCell = cellIndex
			}
		//------ Get Clicked Row and Cell Index ---------------------------- // End -->


		//------ Filter Records-------------------------------------------- //Start-->
			function filter_B(input){tableInside_B()}
			function tableInside_B(){
				let filter = document.querySelector('#filter_B').value.toUpperCase(); //capturing input value

				if (filter.length >= 3) {
					let abc = list_B.filter(x => x.itmName.toLowerCase().includes(filter.toLowerCase()))
					Table_B(abc)
				}else if (filter == '*'){
					Table_B(list_B)
				}
				else {
					Table_B(list_B)
				}
			}

			function remEmpAfterSave(){
				const filteredData = list_B.filter((employee) => employee.cusCode !== cuslCode);
				list_B = filteredData
				Table_B(list_B)
			}
		//------ Filter Records --------------------------------------------// End -->


		//-------Temporary Item Entry as General Item ------------------ //Start-->
			function genItem(){
				// Get the table row and cell elements
				var tableB = document.getElementById('myTable')                      
				ccd = tableB.rows[clickRow].cells[clickCell+2].getElementsByTagName('input')[0].value = '10000000'
				ccd = tableB.rows[clickRow].cells[clickCell+3].getElementsByTagName('input')[0].value = 'General Item'
				hidePop_B()
			}
		//-------Temporary Customer Entry as Cash Customer ------------- // End -->


		//-------Run function On Click to "show the list Div"........... //Start-->
			function showPop_B(){ 
				var abbc = document.getElementById("Pop_B");
				abbc.classList.toggle("hide"); 
				abbc.style.display = "block";
			}

			function hidePop_B(){
				var abbc = document.getElementById("Pop_B");
				abbc.style.display = "none"; 
			}

			function custHide(){
				var abbc = document.getElementById("conCol");
				abbc.style.display = "none"; 
			}
		//-------Run function On Click to "show the list Div"........... // End -->


		//-------Temporary Customer Entry as Cash Customer ------------- //Start-->
			function cashCustomer(){
				document.querySelector('#cusCode').value = "2310101"
				document.querySelector('#cusName').value = "Cash Customer";
				hidePop_B()
				//savDisable('No')  //to active Save option
			}
		//-------Temporary Customer Entry as Cash Customer ------------- // End -->


	</script>


	<style>
		/* Customer Search Table ------------------------------------------------- */
			#Pop_B {
				position:absolute;
				margin: 0px 0 0 127px;
				display:none;
				width:500px; 
				min-height:150px;
				max-height:300px; 
				background:#fcffff; 
				border: 1px solid #3B5998;
				box-shadow: 4px 6px 9px -4px rgba(0,0,0,0.4);
				border-radius: 10px;
				overflow-y: auto;
				z-index:10; 
			}
			#Pop_B .sDiv{
				position:sticky;
				top:0;
				display:flex; 
				justify-content:start;
				align-items: center;
				background:#00324A;
				min-height:30px;

			}
			.sDiv .Sear {
				position:relative;
				margin-left: 5px;
				left: 2px;
			}
			.sDiv .Sear .Icon {
				position:absolute; 
				color:gray;
			}
			.sDiv .Sear .Icon.iA{
				left:7px;
				top: 4px;
			}
			.sDiv .Sear .Icon.iB{
				font-size: 10px;
				top: 2px;
				left:25px;
			}
			.sDiv .Sear input{
				border-radius: 25px;
				min-width:250px;
				height: 20px;
				margin-left: 5px;
				padding-left: 43px;
				font-size: 13px;
				box-shadow: 0px 0px 0px #EBEBEB;
				border: 1px solid rgb(209, 207, 207);  
			}
			.sDiv .boxAA{
				background:#ffe09e;
				padding: 3px 10px;
				margin: 0 5px;
				font-size: 12px;
				border-radius: 25px;
				cursor:pointer;
			}
			.sDiv .boxAA:hover{
				background:#ffc549;
			}
			.sDiv .boxAB{
				right: 20px;
				background:#acd3ff;
				padding: 3px 10px;
				font-size: 12px;
				border-radius: 25px;
				cursor:pointer;
			}
			.sDiv .boxAB:hover{
				background:#5da8fe;
			}
			.sDiv .closeBtn{
				position:absolute; 
				right:2px; top:2px; 
				color:red; 
				background:lightgray; 
				border-radius:50%; 
				width:20px; height:20px; 
				text-align:center;
				cursor:pointer;"
			}
		/* Table ------------------------------------------------------------------*/
			#table_B {
				margin:0;
				font-size: 11px;        
				border-collapse: collapse;
				width: 100%;
			}
			#table_B .tableHead {
				background: rgb(227, 236, 255);
				position:sticky;
				border: 1px solid #30569c;
				box-shadow: 0px 6px 2px -4px rgba(0,0,0,0.4);
				top:28px;
				z-index: 100;
			}
			#table_B td, th {
				text-align: left;
				padding: 3px 8px;
				background: none;
				border: 1px dotted rgb(149, 202, 243);
				border-collapse: collapse;
			}
		/* Customer Search Table --------------------------------------------------*/
	</style>

<!--==== Item Deatil Popup Window ====================================// End -->



<!--.........................................................................-->
<!--==== Employee Deatil Popup Window ================================//Start-->
<!--.........................................................................-->
	<script>
		//--==== Fetch Item Data to Select ================================= //Start-->
			let list_S=[]; // Declare a global variable to store the data
			
			async function fetchPop_S(){
				const response = await fetch(`${basInfo.IP[0]}/empSalary`)
				const data = await response.json()
				list_S = data  //when call showRecord() function data will save in finalData
				Table_S(list_S)
			}
		//--==== Fetch Item Data to Select ================================= // End -->


		//------ Render Item Table ----------------------------------------- //Start-->
			function Table_S(dataList){
				//console.log(dataList)
				var table = document.getElementById('popBody_S').innerHTML=` ${dataList.map(temList).join('')}`
				function temList (e){
					return`<tr">
											<td style="color:#0464d1">${e.empCode}</td>
											<td>${e.empName}</td>
									</tr>`
				}
				//-- on click select the row -------------------------
				var cells = document.querySelectorAll(`#popBody_S td`);
				for (var j = 0; j < cells.length; j++) {
					var cell_S1 = cells[j];
					cell_S1.onclick =  async function () {
						var rowId = this.parentNode.rowIndex-1;
						var rowSelected = document.querySelectorAll(`#popBody_S tr`)[rowId];
						clickVal1 = rowSelected.cells[0].innerHTML;
						let cID =clickVal1.replace(/\s/g, '');

						clickVal2 = rowSelected.cells[1].innerHTML;
						let cName =clickVal2

						document.querySelector('#spName').value = cName;
						document.querySelector('#salPer').value = cID;

						hidePop_S()
						savDisable('No')
					}
				}
			}
		//------ Render Item Table ----------------------------------------- // End -->


		//------ Filter Records-------------------------------------------- //Start-->
			function filter_S(input){tableInside_S()}
			function tableInside_S(){
				let filter = document.querySelector('#filter_S').value.toUpperCase(); //capturing input value

				if (filter.length >= 3) {
					let abc = list_S.filter(x => x.empName.toLowerCase().includes(filter.toLowerCase()))
					Table_S(abc)
				}else if (filter == '*'){
					Table_S(list_S)
				}
				else {
					Table_S(list_S)
				}
			}

			function remEmpAfterSave(){
				const filteredData = list_S.filter((employee) => employee.empCode !== emplCode);
				list_S = filteredData
				Table_S(list_S)
			}
		//------ Filter Records --------------------------------------------// End -->


		//-------Run function On Click to "show the list Div"........... //Start-->
			function showPop_S(){ 
				var abbc = document.getElementById("Pop_S");
				abbc.classList.toggle("hide"); 
				abbc.style.display = "block";
			}

			function hidePop_S(){
				let abbs = document.getElementById("Pop_S");
				abbs.style.display = "none"; 
			}

			function custHide(){
				var abbc = document.getElementById("conCol");
				abbc.style.display = "none"; 
			}
		//-------Run function On Click to "show the list Div"........... // End -->

	</script>


	<style>
		/* Customer Search Table ------------------------------------------------- */
			#Pop_S {
				position:absolute;
				margin: 0px 0 0 127px;
				display:none;
				width:350px; 
				min-height:150px;
				max-height:300px; 
				background:#fcffff; 
				border: 1px solid #3B5998;
				box-shadow: 4px 6px 9px -4px rgba(0,0,0,0.4);
				border-radius: 10px;
				overflow-y: auto;
				z-index:10; 
				right:0px;
				top:-150px;
			}
			#Pop_S .sDiv{
				position:sticky;
				top:0;
				display:flex; 
				justify-content:start;
				align-items: center;
				background:#00324A;
				min-height:30px;
			}
			.sDiv .Sear {
				position:relative;
				margin-left: 5px;
				left: 2px;
			}
			.sDiv .Sear .Icon {
				position:absolute; 
				color:gray;
			}
			.sDiv .Sear .Icon.iA{
				left:7px;
				top: 4px;
			}
			.sDiv .Sear .Icon.iB{
				font-size: 10px;
				top: 2px;
				left:25px;
			}
			.sDiv .Sear input{
				border-radius: 25px;
				min-width:250px;
				height: 20px;
				margin-left: 5px;
				padding-left: 43px;
				font-size: 13px;
				box-shadow: 0px 0px 0px #EBEBEB;
				border: 1px solid rgb(209, 207, 207);  
			}
			.sDiv .boxAA{
				background:#ffe09e;
				padding: 3px 10px;
				margin: 0 5px;
				font-size: 12px;
				border-radius: 25px;
				cursor:pointer;
			}
			.sDiv .boxAA:hover{
				background:#ffc549;
			}
			.sDiv .boxAB{
				right: 20px;
				background:#acd3ff;
				padding: 3px 10px;
				font-size: 12px;
				border-radius: 25px;
				cursor:pointer;
			}
			.sDiv .boxAB:hover{
				background:#5da8fe;
			}
			.sDiv .closeBtn{
				position:absolute; 
				right:2px; top:2px; 
				color:red; 
				background:lightgray; 
				border-radius:50%; 
				width:20px; height:20px; 
				text-align:center;
				cursor:pointer;"
			}
		/* Table ------------------------------------------------------------------*/
			#table_S {
				margin:0;
				font-size: 11px;        
				border-collapse: collapse;
				width: 100%;
			}
			#table_S .tableHead {
				background: rgb(227, 236, 255);
				position:sticky;
				border: 1px solid #30569c;
				box-shadow: 0px 6px 2px -4px rgba(0,0,0,0.4);
				top:28px;
				z-index: 100;
			}
			#table_S td, th {
				text-align: left;
				padding: 3px 8px;
				background: none;
				border: 1px dotted rgb(149, 202, 243);
				border-collapse: collapse;
			}
		/* Customer Search Table --------------------------------------------------*/
	</style>

<!--==== Customer Deatil Popup Window ================================// End -->



{% endblock body %}